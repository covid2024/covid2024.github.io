const utils = {
    getAdjacentCells(index, rows, cols) {
        const adjacent = [];
        const row = Math.floor(index / cols);
        const col = index % cols;

        for (let i = -config.spreadRadius; i <= config.spreadRadius; i++) {
            for (let j = -config.spreadRadius; j <= config.spreadRadius; j++) {
                if (row + i >= 0 && row + i < rows && col + j >= 0 && col + j < cols) {
                    if (i !== 0 || j !== 0) {
                        if (Math.abs(i) + Math.abs(j) <= config.spreadRadius) {
                            adjacent.push(index + i * cols + j);
                        }
                    }
                }
            }
        }

        return adjacent;
    },

    showCellInfo(cellIndex, city) {
        const cellData = city[cellIndex];
        const cellInfoPanel = document.getElementById('cell-info-panel');
        const cellInfoContent = document.getElementById('cell-info-content');

        let content = '';

        if (cellData.type === 'residential') {
            content += `<b>Lo·∫°i:</b> Khu d√¢n c∆∞<br>`;
            content += `<b>M·∫≠t ƒë·ªô d√¢n s·ªë:</b> ${cellData.populationDensity} ng∆∞·ªùi/khu<br>`;
            content += `<b>ƒê·ªô ·∫©m:</b> ${cellData.humidity}%<br>`;
            content += `<b>Nhi·ªát ƒë·ªô:</b> ${cellData.temperature}¬∞C<br>`;
            content += `<b>T·ª∑ l·ªá di chuy·ªÉn:</b> ${cellData.movementRate}%/ng√†y<br>`;
            content += `<b>Ca nhi·ªÖm:</b> ${cellData.infected}<br>`;
            content += `<b>Mi·ªÖn d·ªãch:</b> ${cellData.immune}<br>`;
            content += `<b>T·ªâ l·ªá l√¢y nhi·ªÖm:</b> ${((cellData.infected / cellData.population) * 100).toFixed(2)}%<br>`;
            content += `<b>B·ªánh vi·ªán:</b> ${cellData.hospitals} üè•<br>`;
            content += `<b>Ph√≤ng lab:</b> ${cellData.labs} üß™<br>`;
            content += `<b>Khoanh v√πng:</b> ${cellData.isQuarantined ? 'R·ªìi' : 'Ch∆∞a'}<br>`;
        } else if (cellData.type === 'hospital') {
            content += `<b>Lo·∫°i:</b> B·ªánh vi·ªán<br>`;
        } else if (cellData.type === 'lab') {
            content += `<b>Lo·∫°i:</b> Ph√≤ng th√≠ nghi·ªám<br>`;
        }

        cellInfoContent.innerHTML = content;
        cellInfoPanel.style.display = 'block';
    },

    hideCellInfo() {
        document.getElementById('cell-info-panel').style.display = 'none';
    },

    addNotification(type, message) {
        const notificationsContainer = document.getElementById('notifications-container');
        const notification = document.createElement('div');
        notification.classList.add('notification', type);
        notification.innerText = message;
        notificationsContainer.appendChild(notification);

        // Automatically remove the notification after a few seconds
        setTimeout(() => {
            notificationsContainer.removeChild(notification);
        }, 5000);
    },

    updateCellColor(cell, infectionRate) {
        cell.classList.remove('low-risk', 'medium-risk', 'high-risk');
        if (infectionRate > 0.5) {
            cell.classList.add('high-risk');
        } else if (infectionRate > 0.2) {
            cell.classList.add('medium-risk');
        } else if (infectionRate > 0) {
            cell.classList.add('low-risk');
        }
    },

    triggerVirusAlert(message) {
        const alert = document.querySelector('.virus-alert');
        alert.innerText = message;
        alert.style.display = 'none';
        setTimeout(() => {
            alert.style.display = 'flex';
        }, 100);
    }
};
