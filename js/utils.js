// js/utils.js
const utils = {
  getAdjacentCells(index, rows, cols) {
    const adjacent = [];
    const row = Math.floor(index / cols);
    const col = index % cols;

    for (let i = -config.spreadRadius; i <= config.spreadRadius; i++) {
      for (let j = -config.spreadRadius; j <= config.spreadRadius; j++) {
        if (row + i >= 0 && row + i < rows && col + j >= 0 && col + j < cols) {
          if (i !== 0 || j !== 0) {
            if (Math.abs(i) + Math.abs(j) <= config.spreadRadius) {
              adjacent.push(index + i * cols + j);
            }
          }
        }
      }
    }

    return adjacent;
  },

  showTooltip(cellIndex, city) {
    const cellData = city[cellIndex];
    const tooltip = document.getElementById(`cell-${cellIndex}`).querySelector('.tooltip');
    let tooltipContent = '';

    if (cellData.type === 'residential') {
      tooltipContent += `<b>Lo·∫°i:</b> Khu d√¢n c∆∞<br>`;
      tooltipContent += `<b>M·∫≠t ƒë·ªô d√¢n s·ªë:</b> ${cellData.populationDensity} ng∆∞·ªùi/khu<br>`;
      tooltipContent += `<b>ƒê·ªô ·∫©m:</b> ${cellData.humidity}%<br>`;
      tooltipContent += `<b>Nhi·ªát ƒë·ªô:</b> ${cellData.temperature}¬∞C<br>`;
      tooltipContent += `<b>T·ª∑ l·ªá di chuy·ªÉn:</b> ${cellData.movementRate}%/ng√†y<br>`;
      tooltipContent += `<b>Ca nhi·ªÖm:</b> ${cellData.infected}<br>`;
      tooltipContent += `<b>Mi·ªÖn d·ªãch:</b> ${cellData.immune}<br>`;
      tooltipContent += `<b>T·ªâ l·ªá l√¢y nhi·ªÖm:</b> ${(cellData.infected / cellData.population * 100).toFixed(2)}%<br>`;
      tooltipContent += `<b>B·ªánh vi·ªán:</b> ${cellData.hospitals} üè•<br>`;
      tooltipContent += `<b>Ph√≤ng lab:</b> ${cellData.labs} üß™<br>`;
      tooltipContent += `<b>Khoanh v√πng:</b> ${cellData.isQuarantined ? 'R·ªìi' : 'Ch∆∞a'}<br>`;
    } else if (cellData.type === 'hospital') {
      tooltipContent += `<b>Lo·∫°i:</b> B·ªánh vi·ªán<br>`;
    } else if (cellData.type === 'lab') {
      tooltipContent += `<b>Lo·∫°i:</b> Ph√≤ng th√≠ nghi·ªám<br>`;
    }

    tooltip.innerHTML = tooltipContent;
    tooltip.style.opacity = 1;
  },

  hideTooltip(event) {
    const tooltip = event.target.querySelector('.tooltip');
    if (tooltip) {
      tooltip.style.opacity = 0;
    }
  },

  addNotification(type, message) {
    const notificationsContainer = document.getElementById('notifications-container');
    const notification = document.createElement('div');
    notification.classList.add('notification', type);
    notification.innerText = message;
    notificationsContainer.appendChild(notification);

    // Automatically remove the notification after a few seconds
    setTimeout(() => {
      notificationsContainer.removeChild(notification);
    }, 5000);
  },

  updateCellColor(cell, infectionRate) {
    cell.classList.remove('low-risk', 'medium-risk', 'high-risk');
    if (infectionRate > 0.5) {
      cell.classList.add('high-risk');
    } else if (infectionRate > 0.2) {
      cell.classList.add('medium-risk');
    } else if (infectionRate > 0) {
      cell.classList.add('low-risk');
    }
  },

  triggerVirusAlert(message) {
    const alert = document.querySelector('.virus-alert');
    alert.innerText = message;
    alert.style.display = 'none';
    setTimeout(() => {
      alert.style.display = 'flex';
    }, 100);
  }
};
